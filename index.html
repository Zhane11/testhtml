<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Điều khiển LED (Test)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body style="text-align:center; font-family: Arial;">
    <h1>💡 Điều khiển LED (Realtime)</h1>
    <p>Trạng thái: <b id="status">⏳ ĐANG KẾT NỐI...</b></p>
    <button id="toggleBtn" style="font-size:20px;" disabled>Đang kết nối...</button>

<script>
    const BACKEND_URL = "http://192.168.1.62:5000"; // IP máy chạy Flask

    const statusEl = document.getElementById("status");
    const toggleBtn = document.getElementById("toggleBtn");

    // Kết nối tới server qua Socket.IO
    const socket = io(BACKEND_URL);

    socket.on("connect", () => {
        console.log("✅ Đã kết nối server");
        toggleBtn.disabled = false;
        toggleBtn.innerText = "Bật/Tắt LED";
        statusEl.innerText = "ĐANG ĐỒNG BỘ...";
    });

    socket.on("led_state", (data) => {
        console.log("Nhận trạng thái:", data);
        statusEl.innerText = data.on ? "🔆 BẬT" : "💤 TẮT";
    });

    socket.on("disconnect", () => {
        console.warn("🚫 Mất kết nối server!");
        statusEl.innerText = "⚠️ MẤT KẾT NỐI";
        toggleBtn.disabled = true;
        toggleBtn.innerText = "Đang kết nối...";
    });

    toggleBtn.addEventListener("click", async () => {
        try {
            const response = await fetch(`${BACKEND_URL}/toggle`, { method: "POST" });
            console.log("Đã gửi lệnh toggle:", response.status);
        } catch (error) {
            console.error("Lỗi khi gửi toggle:", error);
        }
    });
</script>
</body>
</html>
