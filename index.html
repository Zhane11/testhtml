<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Äiá»u khiá»ƒn LED (Test)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body style="text-align:center; font-family: Arial;">
    <h1>ğŸ’¡ Äiá»u khiá»ƒn LED (Realtime)</h1>
    <p>Tráº¡ng thÃ¡i: <b id="status">â³ ÄANG Káº¾T Ná»I...</b></p>
    <button id="toggleBtn" style="font-size:20px;" disabled>Äang káº¿t ná»‘i...</button>

<script>
    // ======== Äá»”I IP nÃ y thÃ nh IP mÃ¡y cháº¡y Flask ========
    const BACKEND_URL = "http://192.168.1.100:5000"; // Ä‘á»•i theo IP mÃ¡y báº¡n

    const statusEl = document.getElementById("status");
    const btnEl = document.getElementById("toggleBtn");

    // Káº¿t ná»‘i Socket.IO
    const socket = io(BACKEND_URL);

    socket.on("connect", () => {
        console.log("âœ… ÄÃ£ káº¿t ná»‘i server");
        btnEl.disabled = false;
        btnEl.innerText = "Báº­t/Táº¯t LED";
    });

    socket.on("disconnect", () => {
        console.log("âš  Máº¥t káº¿t ná»‘i server");
        statusEl.innerText = "Máº¤T Káº¾T Ná»I";
        btnEl.disabled = true;
        btnEl.innerText = "Äang káº¿t ná»‘i...";
    });

    socket.on("led_state", (data) => {
        console.log("Nháº­n tráº¡ng thÃ¡i:", data);
        statusEl.innerText = data.on ? "Báº¬T âœ…" : "Táº®T âŒ";
        btnEl.innerText = data.on ? "Táº¯t LED" : "Báº­t LED";
    });

    // NÃºt gá»­i toggle
    btnEl.addEventListener("click", async () => {
        try {
            const response = await fetch(`${BACKEND_URL}/toggle`, {
                method: "POST"
            });
            if (!response.ok) throw new Error("Server tráº£ vá» lá»—i!");
            console.log("ÄÃ£ gá»­i lá»‡nh toggle");
        } catch (err) {
            console.error("Lá»—i khi gá»­i toggle:", err);
        }
    });
</script>

</body>
</html>
